function R(j){let H=new ArrayBuffer(8);return new DataView(H).setBigUint64(0,BigInt(j)),new Uint8Array(H)}function U(j){let z="",B=[];j=j.replace(/=+$/,"").toUpperCase();for(let x of j){let L="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".indexOf(x);if(L===-1)throw Error("Invalid Base32 character in secret");z+=L.toString(2).padStart(5,"0")}for(let x=0;x+8<=z.length;x+=8)B.push(parseInt(z.substring(x,x+8),2));return new Uint8Array(B)}function Y(j=32){let z="",B=new Uint8Array(j);globalThis.crypto.getRandomValues(B);for(let x=0;x<j;x++)z+="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"[B[x]%32];return z}async function k(j,H,z={}){let{digits:B=6,algorithm:x="SHA-1"}=z,L=await globalThis.crypto.subtle.importKey("raw",j,{name:"HMAC",hash:x},!1,["sign"]),M=new Uint8Array(await globalThis.crypto.subtle.sign("HMAC",L,R(H))),X=M[M.length-1]&15;return(((M[X]&127)<<24|(M[X+1]&255)<<16|(M[X+2]&255)<<8|M[X+3]&255)%10**B).toString().padStart(B,"0")}async function v(j,H={}){let{timeStep:z=30,digits:B=6,timestamp:x=Date.now(),algorithm:L="SHA-1"}=H,M=U(j),X=Math.floor(x/1000/z);return k(M,X,{digits:B,algorithm:L})}async function C(j,H,z={}){let{window:B=1,timeStep:x=30,digits:L=6,timestamp:M=Date.now(),algorithm:X="SHA-1"}=z,_=U(H),G=Math.floor(M/1000/x);for(let N=-B;N<=B;N++)if(await k(_,G+N,{digits:L,algorithm:X})===j)return!0;return!1}function E(j){let{accountName:H,issuer:z,secret:B,digits:x=6,period:L=30,algorithm:M="SHA-1"}=j,X=encodeURIComponent(`${z}:${H}`),_=new URLSearchParams({secret:B,issuer:z,algorithm:M.replace(/-/g,""),digits:x.toString(),period:L.toString()});return`otpauth://totp/${X}?${_.toString()}`}var J=(j)=>document.getElementById(j),Z=J("secret"),y=J("btn-generate-secret"),A=J("btn-copy-secret"),I=J("btn-generate-code"),O=J("btn-refresh-code"),w=J("code"),b=J("countdown"),F=J("algorithm"),Q=J("digits"),V=J("period"),S=J("token"),$=J("btn-verify"),q=J("verify-result"),T=J("account"),f=J("issuer"),h=J("btn-generate-uri"),P=J("otpauth"),m=J("btn-open-qr"),g=J("qr-container");function W(j){Z.value=j}y.addEventListener("click",()=>{let j=Y();W(j)});A.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(Z.value),A.textContent="Copied!",setTimeout(()=>A.textContent="Copy",1200)}catch{alert("Copy failed — please copy manually.")}});async function K(){try{let j=Z.value||Y(),H=F.value,z=Number(Q.value),B=Number(V.value),x=await v(j,{timeStep:B,digits:z,algorithm:H});w.textContent=x,u(B)}catch(j){w.textContent="ERR",console.error(j)}}I.addEventListener("click",async()=>{if(!Z.value)W(Y());await K()});O.addEventListener("click",K);async function l(){q.textContent="";try{let j=S.value.trim(),H=Z.value;if(!j||!H){q.textContent="Enter both token and secret";return}let z=F.value,B=Number(Q.value),x=Number(V.value),L=await C(j,H,{window:1,timeStep:x,digits:B,algorithm:z});q.textContent=L?"✅ Valid":"❌ Invalid"}catch(j){q.textContent="Error",console.error(j)}}$.addEventListener("click",l);h.addEventListener("click",()=>{let j=T.value||"info@rabbit-company.com",H=f.value||"Rabbit Company",z=Z.value||Y(),B=Number(Q.value),x=Number(V.value),L=F.value,M=E({accountName:j,issuer:H,secret:z,digits:B,period:x,algorithm:L});P.textContent=M,g.src=`https://api.qrserver.com/v1/create-qr-code/?size=256x256&data=${encodeURIComponent(M)}`});m.addEventListener("click",()=>{let j=P.textContent;if(!j||j==="—"){alert("Generate URI first");return}let z=`https://api.qrserver.com/v1/create-qr-code/?size=512x512&data=${encodeURIComponent(j)}`;window.open(z,"_blank")});var D=null;function u(j){if(D)clearInterval(D);let H=Date.now(),z=Math.floor(H/1000),B=j-z%j;function x(){let L=j-Math.floor(Date.now()/1000)%j;if(b.textContent=`refresh in ${L}s`,L<=0)K()}x(),D=setInterval(x,1000)}var p=Y();W(p);K();
