function O(j){let J=new ArrayBuffer(8);return new DataView(J).setBigUint64(0,BigInt(j)),new Uint8Array(J)}function U(j){let z="",H=[];j=j.replace(/=+$/,"").toUpperCase();for(let B of j){let M="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".indexOf(B);if(M===-1)throw Error("Invalid Base32 character in secret");z+=M.toString(2).padStart(5,"0")}for(let B=0;B+8<=z.length;B+=8)H.push(parseInt(z.substring(B,B+8),2));return new Uint8Array(H)}function _(j=32){let z="",H=new Uint8Array(j);globalThis.crypto.getRandomValues(H);for(let B=0;B<j;B++)z+="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"[H[B]%32];return z}async function v(j,J,z={}){let{digits:H=6,algorithm:B="SHA-1"}=z,M=await globalThis.crypto.subtle.importKey("raw",j,{name:"HMAC",hash:B},!1,["sign"]),X=new Uint8Array(await globalThis.crypto.subtle.sign("HMAC",M,O(J))),Y=X[X.length-1]&15;return(((X[Y]&127)<<24|(X[Y+1]&255)<<16|(X[Y+2]&255)<<8|X[Y+3]&255)%10**H).toString().padStart(H,"0")}async function C(j,J={}){let{timeStep:z=30,digits:H=6,timestamp:B=Date.now(),algorithm:M="SHA-1"}=J,X=U(j),Y=Math.floor(B/1000/z);return v(X,Y,{digits:H,algorithm:M})}async function E(j,J,z={}){let{window:H=1,timeStep:B=30,digits:M=6,timestamp:X=Date.now(),algorithm:Y="SHA-1"}=z,Z=U(J),k=Math.floor(X/1000/B);for(let A=-H;A<=H;A++)if(await v(Z,k+A,{digits:M,algorithm:Y})===j)return!0;return!1}function P(j){let{accountName:J,issuer:z,secret:H,digits:B=6,period:M=30,algorithm:X="SHA-1"}=j,Y=encodeURIComponent(`${z}:${J}`),Z=new URLSearchParams({secret:H,issuer:z,algorithm:X.replace(/-/g,""),digits:B.toString(),period:M.toString()});return`otpauth://totp/${Y}?${Z.toString()}`}var L=(j)=>document.getElementById(j),q=L("secret"),b=L("btn-generate-secret"),F=L("btn-copy-secret"),y=L("btn-generate-code"),R=L("btn-refresh-code"),w=L("code"),$=L("countdown"),V=L("algorithm"),W=L("digits"),D=L("period"),S=L("token"),f=L("btn-verify"),K=L("verify-result"),T=L("account"),h=L("issuer"),g=L("btn-generate-uri"),I=L("otpauth"),m=L("btn-open-qr"),l=L("qr-container");function G(j){q.value=j}b.addEventListener("click",()=>{let j=_();G(j)});F.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(q.value),F.textContent="Copied!",setTimeout(()=>F.textContent="Copy",1200)}catch{alert("Copy failed — please copy manually.")}});async function x(){try{let j=q.value||_(),J=V.value,z=Number(W.value),H=Number(D.value),B=await C(j,{timeStep:H,digits:z,algorithm:J});w.textContent=B,u(H)}catch(j){w.textContent="ERR",console.error(j)}}y.addEventListener("click",async()=>{if(!q.value)G(_());await x()});R.addEventListener("click",x);async function p(){K.textContent="";try{let j=S.value.trim(),J=q.value;if(!j||!J){K.textContent="Enter both token and secret";return}let z=V.value,H=Number(W.value),B=Number(D.value),M=await E(j,J,{window:1,timeStep:B,digits:H,algorithm:z});K.textContent=M?"✅ Valid":"❌ Invalid"}catch(j){K.textContent="Error",console.error(j)}}f.addEventListener("click",p);g.addEventListener("click",()=>{let j=T.value||"info@rabbit-company.com",J=h.value||"Rabbit Company",z=q.value||_(),H=Number(W.value),B=Number(D.value),M=V.value,X=P({accountName:j,issuer:J,secret:z,digits:H,period:B,algorithm:M});I.textContent=X,l.src=`https://api.qrserver.com/v1/create-qr-code/?size=256x256&data=${encodeURIComponent(X)}`});m.addEventListener("click",()=>{let j=I.textContent;if(!j||j==="—"){alert("Generate URI first");return}let z=`https://api.qrserver.com/v1/create-qr-code/?size=512x512&data=${encodeURIComponent(j)}`;window.open(z,"_blank")});var N=null,Q=null;function u(j){if(N)clearInterval(N);if(Q)clearTimeout(Q);let J=Date.now(),z=Math.floor(J/1000),H=(Math.floor(z/j)+1)*j,B=(H-z)*1000;Q=setTimeout(()=>{x()},B);function M(){let X=Date.now(),Y=Math.floor(X/1000),Z=H-Y;if($.textContent=`refresh in ${Z}s`,Z<=0)clearInterval(N)}M(),N=setInterval(M,1000)}var a=_();G(a);x();
